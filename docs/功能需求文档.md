# 邮箱客户端功能需求文档

## 文档信息
- **项目名称**: Mail Client (邮箱客户端)
- **文档版本**: v1.0
- **创建日期**: 2026-02-08
- **文档类型**: 功能需求与规划文档

## 1. 项目概述

### 1.1 项目背景
本项目是一个基于 Node.js 的命令行邮箱客户端，旨在提供与 Thunderbird 和 Microsoft Outlook 相媲美的完整邮件管理功能。

### 1.2 当前实现状态
根据代码库分析，当前已实现以下核心功能：
- ✅ IMAP/SMTP 协议支持
- ✅ 邮件同步与本地存储 (SQLite)
- ✅ 邮件列表查看与分页
- ✅ 邮件详情查看
- ✅ 邮件发送（支持附件）
- ✅ 邮件搜索（关键词、发件人、主题、日期）
- ✅ 附件下载与管理
- ✅ 已读/未读状态管理
- ✅ 文件夹管理
- ✅ 配置管理与密码加密
- ✅ 增量同步
- ✅ 日志系统

### 1.3 目标
补充和完善邮箱客户端功能，使其具备 Thunderbird 和 Outlook 的所有常用基础功能，提供完整的邮件管理体验。

## 2. 功能需求分类

### 2.1 核心邮件功能 (Core Email Features)

#### 2.1.1 邮件操作 - 已实现 ✅
- [x] 接收邮件 (IMAP)
- [x] 发送邮件 (SMTP)
- [x] 查看邮件列表
- [x] 查看邮件详情
- [x] 标记已读/未读
- [x] 附件下载
- [x] 附件发送

#### 2.1.2 邮件操作 - 待实现 🔲
- [ ] **回复邮件** (Reply)
  - 单人回复
  - 回复全部 (Reply All)
  - 引用原文
  - 保留原邮件格式

- [ ] **转发邮件** (Forward)
  - 转发邮件内容
  - 转发附件
  - 添加转发备注

- [ ] **草稿管理** (Drafts)
  - 保存草稿
  - 编辑草稿
  - 删除草稿
  - 自动保存草稿

- [ ] **邮件删除** (Delete)
  - 移动到垃圾箱
  - 永久删除
  - 批量删除
  - 清空垃圾箱

- [ ] **邮件移动** (Move)
  - 移动到指定文件夹
  - 批量移动

- [ ] **邮件复制** (Copy)
  - 复制到其他文件夹

- [ ] **撤销发送** (Undo Send)
  - 发送后短时间内撤回
  - 可配置撤回时间窗口

### 2.2 邮件组织功能 (Organization Features)

#### 2.2.1 文件夹管理 - 部分实现 ⚠️
- [x] 基础文件夹支持 (INBOX, Sent, Drafts)
- [ ] **创建自定义文件夹**
- [ ] **重命名文件夹**
- [ ] **删除文件夹**
- [ ] **嵌套文件夹** (子文件夹)
- [ ] **文件夹收藏** (Favorites)
- [ ] **文件夹排序**
- [ ] **智能文件夹** (虚拟文件夹，基于搜索条件)

#### 2.2.2 标签与分类 - 未实现 🔲
- [ ] **邮件标签** (Tags/Labels)
  - 创建自定义标签
  - 为邮件添加/移除标签
  - 多标签支持
  - 标签颜色
  - 按标签筛选

- [ ] **邮件分类** (Categories)
  - 预定义分类（工作、个人、重要等）
  - 自定义分类
  - 分类颜色标记

- [ ] **星标/标记** (Star/Flag)
  - 标记重要邮件
  - 多种标记类型
  - 按标记筛选

#### 2.2.3 过滤器与规则 - 未实现 🔲
- [ ] **邮件过滤规则** (Filters/Rules)
  - 基于发件人的规则
  - 基于主题的规则
  - 基于关键词的规则
  - 基于附件的规则
  - 自动移动到文件夹
  - 自动标记/分类
  - 自动转发
  - 自动删除
  - 规则优先级
  - 规则启用/禁用

- [ ] **快速过滤** (Quick Filters)
  - 未读邮件
  - 已标记邮件
  - 有附件邮件
  - 来自联系人的邮件

### 2.3 搜索功能 - 部分实现 ⚠️

#### 已实现 ✅
- [x] 关键词搜索
- [x] 发件人搜索
- [x] 主题搜索
- [x] 日期范围搜索
- [x] 文件夹搜索

#### 待实现 🔲
- [ ] **高级搜索**
  - 收件人搜索
  - 抄送人搜索
  - 附件名搜索
  - 邮件大小搜索
  - 标签搜索
  - 已读/未读状态搜索
  - 组合条件搜索

- [ ] **搜索建议** (Search Suggestions)
  - 自动补全
  - 搜索历史

- [ ] **保存搜索** (Saved Searches)
  - 保存常用搜索条件
  - 快速访问保存的搜索

### 2.4 联系人管理 - 未实现 🔲

- [ ] **通讯录** (Address Book)
  - 添加联系人
  - 编辑联系人
  - 删除联系人
  - 联系人分组
  - 导入联系人 (CSV, vCard)
  - 导出联系人

- [ ] **自动收集联系人**
  - 从发送/接收邮件中自动添加

- [ ] **联系人搜索**
  - 按姓名搜索
  - 按邮箱地址搜索

- [ ] **通讯组** (Distribution Lists)
  - 创建邮件组
  - 群发邮件

### 2.5 日历与任务 - 未实现 🔲

- [ ] **日历功能** (Calendar)
  - 创建事件
  - 编辑事件
  - 删除事件
  - 事件提醒
  - 重复事件
  - 日/周/月视图

- [ ] **会议邀请**
  - 发送会议邀请
  - 接受/拒绝邀请
  - 查看参与者状态

- [ ] **任务管理** (Tasks/To-Do)
  - 创建任务
  - 标记完成
  - 任务优先级
  - 任务截止日期
  - 任务提醒

### 2.6 安全与隐私功能

#### 已实现 ✅
- [x] 密码加密存储 (AES-256-CBC)
- [x] TLS/SSL 连接

#### 待实现 🔲
- [ ] **垃圾邮件过滤** (Spam Filter)
  - 自动识别垃圾邮件
  - 移动到垃圾箱
  - 白名单/黑名单
  - 学习型过滤器

- [ ] **钓鱼邮件检测** (Phishing Detection)
  - 可疑链接警告
  - 伪造发件人检测

- [ ] **邮件加密** (Encryption)
  - S/MIME 支持
  - PGP/GPG 支持
  - 端到端加密

- [ ] **数字签名** (Digital Signature)
  - 签名邮件
  - 验证签名

- [ ] **隐私保护**
  - 阻止远程图片加载
  - 阻止跟踪像素
  - 隐藏 IP 地址

### 2.7 邮件模板与签名

- [ ] **邮件签名** (Signatures)
  - 创建多个签名
  - HTML 签名
  - 纯文本签名
  - 自动插入签名
  - 按账户设置不同签名

- [ ] **邮件模板** (Templates)
  - 创建邮件模板
  - 使用模板快速撰写
  - 模板变量替换

### 2.8 多账户管理 - 部分实现 ⚠️

#### 当前状态
- [x] 单账户配置
- [ ] **多账户支持**
  - 添加多个邮箱账户
  - 账户切换
  - 统一收件箱 (Unified Inbox)
  - 按账户分别显示
  - 账户别名
  - 默认发件账户设置

### 2.9 通知与提醒 - 未实现 🔲

- [ ] **新邮件通知**
  - 桌面通知
  - 声音提醒
  - 通知内容预览
  - 通知过滤（仅重要邮件）

- [ ] **事件提醒**
  - 日历事件提醒
  - 任务截止提醒

### 2.10 导入导出功能 - 未实现 🔲

- [ ] **邮件导出**
  - 导出为 EML 格式
  - 导出为 MBOX 格式
  - 批量导出

- [ ] **邮件导入**
  - 从 EML 导入
  - 从 MBOX 导入
  - 从其他客户端迁移

- [ ] **数据备份**
  - 完整数据库备份
  - 增量备份
  - 自动备份

### 2.11 高级功能

- [ ] **邮件线程** (Conversation Threading)
  - 按对话分组显示
  - 展开/折叠对话
  - 对话视图

- [ ] **快速回复** (Quick Reply)
  - 预设回复模板
  - 一键回复

- [ ] **延迟发送** (Send Later)
  - 定时发送邮件
  - 设置发送时间

- [ ] **邮件跟踪** (Email Tracking)
  - 已读回执
  - 送达通知

- [ ] **邮件归档** (Archive)
  - 归档旧邮件
  - 归档规则
  - 快速归档

- [ ] **邮件打印** (Print)
  - 打印邮件内容
  - 打印预览
  - 打印设置

- [ ] **离线模式** (Offline Mode)
  - 离线查看邮件
  - 离线撰写邮件
  - 联网后自动同步

### 2.12 用户界面增强

- [ ] **主题与外观**
  - 深色模式
  - 浅色模式
  - 自定义主题

- [ ] **布局自定义**
  - 可调整面板大小
  - 隐藏/显示面板
  - 布局预设

- [ ] **快捷键** (Keyboard Shortcuts)
  - 完整快捷键支持
  - 自定义快捷键
  - 快捷键帮助

- [ ] **邮件预览**
  - 预览窗格
  - 预览位置设置（右侧/底部）

### 2.13 性能与同步

#### 已实现 ✅
- [x] 增量同步
- [x] 本地缓存

#### 待实现 🔲
- [ ] **后台同步**
  - 自动定时同步
  - 可配置同步间隔

- [ ] **选择性同步**
  - 仅同步特定文件夹
  - 仅同步最近 N 天邮件
  - 按邮件大小过滤

- [ ] **同步状态显示**
  - 同步进度条
  - 同步错误提示
  - 最后同步时间

### 2.14 其他功能

- [ ] **RSS/Atom 订阅** (Feed Reader)
  - 订阅 RSS 源
  - 阅读订阅内容
  - 订阅管理

- [ ] **邮件统计**
  - 收发邮件统计
  - 存储空间统计
  - 发件人统计

- [ ] **邮件清理**
  - 删除重复邮件
  - 删除大附件邮件
  - 清理旧邮件

## 3. 优先级划分

### P0 - 最高优先级（核心功能补充）
1. 回复邮件 (Reply/Reply All)
2. 转发邮件 (Forward)
3. 草稿管理 (Drafts)
4. 邮件删除 (Delete/Trash)
5. 垃圾邮件过滤 (Spam Filter)
6. 邮件签名 (Signatures)

### P1 - 高优先级（重要组织功能）
1. 邮件标签/标记 (Tags/Flags)
2. 邮件过滤规则 (Filters/Rules)
3. 文件夹管理增强（创建、删除、重命名）
4. 联系人管理 (Address Book)
5. 多账户支持
6. 邮件线程视图 (Conversation Threading)

### P2 - 中优先级（增强功能）
1. 高级搜索
2. 邮件模板
3. 新邮件通知
4. 邮件导入导出
5. 后台自动同步
6. 快速过滤

### P3 - 低优先级（扩展功能）
1. 日历功能
2. 任务管理
3. RSS 订阅
4. 邮件加密 (S/MIME, PGP)
5. 邮件统计
6. 主题与外观自定义

## 4. 技术实现建议

### 4.1 数据库扩展
需要扩展 SQLite 数据库架构以支持新功能：
- 添加 `tags` 表（标签）
- 添加 `filters` 表（过滤规则）
- 添加 `contacts` 表（联系人）
- 添加 `signatures` 表（签名）
- 添加 `templates` 表（模板）
- 添加 `accounts` 表（多账户）
- 扩展 `emails` 表（添加 thread_id, is_starred, labels 等字段）

### 4.2 IMAP 功能扩展
- 实现 IMAP MOVE 命令（移动邮件）
- 实现 IMAP COPY 命令（复制邮件）
- 实现 IMAP FLAGS 操作（标记管理）
- 实现 IMAP THREAD 扩展（邮件线程）

### 4.3 新增模块
- `src/filters/` - 过滤规则引擎
- `src/contacts/` - 联系人管理
- `src/spam/` - 垃圾邮件检测
- `src/calendar/` - 日历功能
- `src/notifications/` - 通知系统
- `src/templates/` - 模板管理

### 4.4 依赖库建议
- `node-notifier` - 桌面通知
- `spamassassin` 或 `rspamd` - 垃圾邮件过滤
- `ical.js` - 日历功能
- `openpgp.js` - PGP 加密
- `cheerio` - HTML 邮件处理
- `turndown` - HTML 转 Markdown

## 5. 参考资料

### Outlook 功能参考
- [Feature comparison between new Outlook and classic Outlook](https://support.microsoft.com/en-au/office/feature-comparison-between-new-outlook-and-classic-outlook-de453583-1e76-48bf-975a-2e9cd2ee16dd)
- [Microsoft Outlook Reviews 2026](https://www.g2crowd.com/products/microsoft-outlook/details)
- [How to Use Microsoft Outlook: 2026 Guide](https://reclaim.ai/blog/how-to-use-microsoft-outlook)

### Thunderbird 功能参考
- [Thunderbird Features](https://www.thunderbird.net/lt/features)
- [Mozilla Thunderbird Wikipedia](https://en.wikipedia.org/wiki/Mozilla_Thunderbird)

### 邮件客户端最佳实践
- [Organize your inbox in Gmail, Outlook, iPhone, and more](https://blog.superhuman.com/how-to-filter-your-emails/)
- [7 of the best Gmail filters to organize your inbox](https://zapier.com/blog/gmail-filters/)

## 6. 实施路线图

### 阶段 1：核心功能补充（1-2 个月）
- 实现 P0 优先级功能
- 完善邮件基本操作
- 添加垃圾邮件过滤

### 阶段 2：组织功能增强（2-3 个月）
- 实现 P1 优先级功能
- 完善文件夹和标签系统
- 实现过滤规则引擎

### 阶段 3：高级功能开发（3-4 个月）
- 实现 P2 优先级功能
- 添加通知系统
- 完善搜索功能

### 阶段 4：扩展功能（按需）
- 实现 P3 优先级功能
- 日历和任务管理
- 加密和安全增强

## 7. 总结

本文档详细列出了邮箱客户端需要补充的功能，以达到与 Thunderbird 和 Outlook 相当的功能水平。建议按照优先级逐步实施，优先完成核心邮件操作功能，然后逐步添加组织和高级功能。

当前项目已经具备良好的基础架构，包括 IMAP/SMTP 支持、本地存储、搜索功能等，在此基础上扩展新功能将会比较顺利。
