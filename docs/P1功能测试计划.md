# P1功能测试计划

## 文档信息
- **项目**: 邮箱客户端 P1 功能
- **版本**: v1.0
- **创建日期**: 2026-02-08
- **测试负责人**: QA Team
- **状态**: 准备中

---

## 1. 测试概述

### 1.1 测试目标
对邮箱客户端的P1优先级功能进行全面测试，确保：
- 所有P1功能按照技术设计文档正确实现
- 功能之间的集成正常工作
- 不影响现有P0功能的正常运行
- 性能满足预期要求
- 边界条件和异常情况得到妥善处理

### 1.2 测试范围

#### 包含的功能模块
1. **标签和标记系统** (Tags/Flags)
   - 标签管理（创建、编辑、删除、列出）
   - 邮件标签操作（添加、移除、查询）
   - 星标功能（标记、取消、查询）
   - 旗标功能（标记、取消、查询）

2. **过滤规则引擎** (Filters/Rules)
   - 规则管理（创建、编辑、删除、列出）
   - 规则条件配置（多种字段和操作符）
   - 规则动作配置（移动、标签、标记等）
   - 规则执行（手动和自动）
   - 规则优先级

3. **文件夹管理增强** (Folder Management)
   - 自定义文件夹（创建、重命名、删除）
   - 嵌套文件夹支持
   - 文件夹收藏
   - 文件夹排序
   - 文件夹统计（未读数、总数）

4. **联系人管理系统** (Address Book)
   - 联系人管理（添加、编辑、删除、列出）
   - 联系人详情（姓名、邮箱、电话、公司等）
   - 联系人分组
   - 联系人搜索
   - 收藏联系人

5. **多账户支持** (Multi-Account)
   - 账户管理（添加、编辑、删除、列出）
   - 账户切换
   - 默认账户设置
   - 统一收件箱视图
   - 账户同步

6. **邮件线程视图** (Conversation Threading)
   - 线程分组显示
   - 线程展开/折叠
   - 线程排序
   - 线程搜索

7. **搜索和过滤增强** (Advanced Search)
   - 高级搜索（多条件组合）
   - 快速过滤（未读、星标、附件等）
   - 搜索历史
   - 保存搜索

8. **同步增强功能** (Sync Enhancement)
   - 自动同步
   - 同步间隔设置
   - 同步进度显示
   - 选择性同步

#### 不包含的功能
- P0功能（已在P0测试中覆盖）
- P2和P3功能（后续版本）
- 第三方集成功能

### 1.3 测试方法

#### 功能测试
- 手动测试所有CLI命令
- 验证每个功能的输入输出
- 测试各种参数组合
- 验证数据持久化

#### 集成测试
- 测试模块间的交互
- 验证数据流转
- 测试跨功能场景

#### 性能测试
- 大数据量测试
- 并发操作测试
- 响应时间测试
- 资源占用测试

#### 边界测试
- 空值测试
- 极限值测试
- 特殊字符测试
- 异常输入测试

#### 回归测试
- 验证P0功能不受影响
- 测试现有命令兼容性
- 验证数据库完整性

---

## 2. 测试环境

### 2.1 硬件环境
- 操作系统: Windows 10/11
- 内存: 8GB+
- 磁盘空间: 10GB+

### 2.2 软件环境
- Node.js: v22.11.0+
- 包管理器: pnpm@10.15.1
- 数据库: SQLite 3
- 邮件服务器: IMAP/SMTP测试服务器

### 2.3 测试数据
- 测试邮箱账户: 至少2个
- 测试邮件: 100+封
- 测试联系人: 50+个
- 测试标签: 10+个
- 测试过滤规则: 10+条

---

## 3. 测试用例设计

### 3.1 标签和标记系统测试用例

#### TC-TAG-001: 创建标签
**前置条件**: 数据库已初始化
**测试步骤**:
1. 执行命令: `mail-client tag create --name "Work" --color "#0000FF"`
2. 验证标签创建成功
3. 执行命令: `mail-client tag list`
4. 验证标签出现在列表中

**预期结果**: 标签创建成功，可以在列表中查看

#### TC-TAG-002: 为邮件添加标签
**前置条件**: 标签已创建，邮件已存在
**测试步骤**:
1. 执行命令: `mail-client tag add --email-id 1 --tag "Work"`
2. 验证标签添加成功
3. 查询邮件标签
4. 验证标签已关联

**预期结果**: 邮件成功关联标签

#### TC-TAG-003: 星标邮件
**前置条件**: 邮件已存在
**测试步骤**:
1. 执行命令: `mail-client star --email-id 1`
2. 验证星标添加成功
3. 查询星标邮件列表
4. 验证邮件出现在星标列表中

**预期结果**: 邮件成功标记为星标

#### TC-TAG-004: 按标签过滤邮件
**前置条件**: 邮件已添加标签
**测试步骤**:
1. 执行命令: `mail-client list --tag "Work"`
2. 验证只显示带有"Work"标签的邮件
3. 验证邮件数量正确

**预期结果**: 正确过滤并显示带标签的邮件

### 3.2 过滤规则引擎测试用例

#### TC-FILTER-001: 创建简单过滤规则
**前置条件**: 数据库已初始化
**测试步骤**:
1. 创建规则: 发件人包含"boss@company.com"
2. 动作: 添加标签"Important"
3. 验证规则创建成功
4. 列出规则，验证规则存在

**预期结果**: 规则创建成功

#### TC-FILTER-002: 执行过滤规则
**前置条件**: 规则已创建，测试邮件已存在
**测试步骤**:
1. 执行命令: `mail-client filter run`
2. 验证符合条件的邮件被添加标签
3. 验证不符合条件的邮件不受影响

**预期结果**: 规则正确执行，邮件被正确处理

#### TC-FILTER-003: 多条件规则（AND逻辑）
**前置条件**: 数据库已初始化
**测试步骤**:
1. 创建规则: 发件人包含"boss" AND 主题包含"urgent"
2. 设置match_all=true
3. 测试符合所有条件的邮件
4. 测试只符合部分条件的邮件

**预期结果**: 只有符合所有条件的邮件被处理

#### TC-FILTER-004: 规则优先级
**前置条件**: 多个规则已创建
**测试步骤**:
1. 创建规则A（优先级10）
2. 创建规则B（优先级5）
3. 执行过滤
4. 验证规则按优先级顺序执行

**预期结果**: 高优先级规则先执行

### 3.3 文件夹管理增强测试用例

#### TC-FOLDER-001: 创建自定义文件夹
**前置条件**: 数据库已初始化
**测试步骤**:
1. 执行命令: `mail-client folder create --name "Projects"`
2. 验证文件夹创建成功
3. 列出文件夹
4. 验证新文件夹出现在列表中

**预期结果**: 文件夹创建成功

#### TC-FOLDER-002: 创建嵌套文件夹
**前置条件**: 父文件夹已存在
**测试步骤**:
1. 创建父文件夹"Work"
2. 创建子文件夹"Work/Projects"
3. 验证嵌套关系正确
4. 列出文件夹树结构

**预期结果**: 嵌套文件夹创建成功，层级关系正确

#### TC-FOLDER-003: 移动邮件到文件夹
**前置条件**: 文件夹和邮件已存在
**测试步骤**:
1. 执行命令: `mail-client move --email-id 1 --folder "Projects"`
2. 验证邮件移动成功
3. 在目标文件夹查询邮件
4. 验证邮件存在

**预期结果**: 邮件成功移动到目标文件夹

#### TC-FOLDER-004: 文件夹收藏
**前置条件**: 文件夹已存在
**测试步骤**:
1. 执行命令: `mail-client folder favorite --name "Projects"`
2. 验证文件夹标记为收藏
3. 列出收藏文件夹
4. 验证文件夹出现在收藏列表中

**预期结果**: 文件夹成功标记为收藏

### 3.4 联系人管理系统测试用例

#### TC-CONTACT-001: 添加联系人
**前置条件**: 数据库已初始化
**测试步骤**:
1. 执行命令: `mail-client contact add --email "john@example.com" --name "John Doe"`
2. 验证联系人创建成功
3. 列出联系人
4. 验证联系人出现在列表中

**预期结果**: 联系人添加成功

#### TC-CONTACT-002: 编辑联系人
**前置条件**: 联系人已存在
**测试步骤**:
1. 执行命令: `mail-client contact edit --id 1 --phone "123-456-7890"`
2. 验证联系人更新成功
3. 查看联系人详情
4. 验证电话号码已更新

**预期结果**: 联系人信息更新成功

#### TC-CONTACT-003: 联系人分组
**前置条件**: 联系人已存在
**测试步骤**:
1. 创建联系人组"Colleagues"
2. 将联系人添加到组
3. 列出组成员
4. 验证联系人在组中

**预期结果**: 联系人成功添加到组

#### TC-CONTACT-004: 搜索联系人
**前置条件**: 多个联系人已存在
**测试步骤**:
1. 执行命令: `mail-client contact search --query "john"`
2. 验证搜索结果包含匹配的联系人
3. 验证不匹配的联系人不在结果中

**预期结果**: 搜索功能正常工作

### 3.5 多账户支持测试用例

#### TC-ACCOUNT-001: 添加第二个账户
**前置条件**: 第一个账户已配置
**测试步骤**:
1. 执行命令: `mail-client account add --email "user2@example.com"`
2. 输入IMAP/SMTP配置
3. 验证账户添加成功
4. 列出账户

**预期结果**: 第二个账户添加成功

#### TC-ACCOUNT-002: 切换账户
**前置条件**: 多个账户已存在
**测试步骤**:
1. 执行命令: `mail-client account switch --email "user2@example.com"`
2. 验证当前账户切换成功
3. 列出邮件，验证显示的是新账户的邮件

**预期结果**: 账户切换成功

#### TC-ACCOUNT-003: 设置默认账户
**前置条件**: 多个账户已存在
**测试步骤**:
1. 执行命令: `mail-client account set-default --email "user1@example.com"`
2. 验证默认账户设置成功
3. 发送邮件时验证使用默认账户

**预期结果**: 默认账户设置成功

#### TC-ACCOUNT-004: 统一收件箱
**前置条件**: 多个账户已存在且有邮件
**测试步骤**:
1. 执行命令: `mail-client list --all-accounts`
2. 验证显示所有账户的邮件
3. 验证邮件标识了所属账户

**预期结果**: 统一收件箱正确显示所有账户邮件

### 3.6 邮件线程视图测试用例

#### TC-THREAD-001: 线程分组
**前置条件**: 存在回复链的邮件
**测试步骤**:
1. 执行命令: `mail-client list --view thread`
2. 验证相关邮件被分组为线程
3. 验证线程显示正确的邮件数量

**预期结果**: 邮件正确分组为线程

#### TC-THREAD-002: 展开线程
**前置条件**: 线程已存在
**测试步骤**:
1. 执行命令: `mail-client thread show --id <thread-id>`
2. 验证显示线程中的所有邮件
3. 验证邮件按时间顺序排列

**预期结果**: 线程正确展开显示

#### TC-THREAD-003: 线程搜索
**前置条件**: 多个线程已存在
**测试步骤**:
1. 执行命令: `mail-client thread search --query "project"`
2. 验证搜索结果包含匹配的线程
3. 验证线程信息完整

**预期结果**: 线程搜索功能正常

### 3.7 搜索和过滤增强测试用例

#### TC-SEARCH-001: 高级搜索（多条件）
**前置条件**: 邮件已存在
**测试步骤**:
1. 执行命令: `mail-client search --from "boss" --subject "report" --has-attachment`
2. 验证搜索结果符合所有条件
3. 验证结果数量正确

**预期结果**: 多条件搜索正确工作

#### TC-SEARCH-002: 快速过滤（未读邮件）
**前置条件**: 存在已读和未读邮件
**测试步骤**:
1. 执行命令: `mail-client list --unread`
2. 验证只显示未读邮件
3. 验证已读邮件不在结果中

**预期结果**: 未读邮件过滤正确

#### TC-SEARCH-003: 快速过滤（有附件）
**前置条件**: 存在有附件和无附件的邮件
**测试步骤**:
1. 执行命令: `mail-client list --has-attachment`
2. 验证只显示有附件的邮件
3. 验证附件信息显示正确

**预期结果**: 附件过滤正确

#### TC-SEARCH-004: 保存搜索
**前置条件**: 数据库已初始化
**测试步骤**:
1. 执行复杂搜索
2. 保存搜索: `mail-client search save --name "Important Reports"`
3. 列出保存的搜索
4. 执行保存的搜索

**预期结果**: 搜索保存和执行功能正常

### 3.8 同步增强功能测试用例

#### TC-SYNC-001: 自动同步
**前置条件**: 账户已配置
**测试步骤**:
1. 启用自动同步: `mail-client sync auto --enable`
2. 设置同步间隔: `mail-client sync interval --minutes 5`
3. 等待同步触发
4. 验证新邮件被同步

**预期结果**: 自动同步功能正常工作

#### TC-SYNC-002: 同步进度显示
**前置条件**: 账户已配置
**测试步骤**:
1. 执行命令: `mail-client sync`
2. 观察同步进度显示
3. 验证显示同步状态和进度百分比

**预期结果**: 同步进度正确显示

#### TC-SYNC-003: 选择性同步（按文件夹）
**前置条件**: 多个文件夹已存在
**测试步骤**:
1. 执行命令: `mail-client sync --folder "INBOX"`
2. 验证只同步指定文件夹
3. 验证其他文件夹不受影响

**预期结果**: 选择性同步正确工作

#### TC-SYNC-004: 同步错误处理
**前置条件**: 账户已配置
**测试步骤**:
1. 断开网络连接
2. 执行同步命令
3. 验证显示友好的错误信息
4. 恢复网络后重试

**预期结果**: 错误处理正确，用户体验良好

---

## 4. 集成测试场景

### 4.1 标签与过滤规则集成
**场景**: 创建过滤规则自动为邮件添加标签
**测试步骤**:
1. 创建标签"Urgent"
2. 创建过滤规则: 主题包含"urgent" -> 添加标签"Urgent"
3. 接收新邮件（主题包含"urgent"）
4. 验证邮件自动添加了标签

### 4.2 多账户与文件夹集成
**场景**: 不同账户有独立的文件夹结构
**测试步骤**:
1. 添加两个账户
2. 为每个账户创建自定义文件夹
3. 切换账户
4. 验证文件夹列表正确显示当前账户的文件夹

### 4.3 联系人与邮件发送集成
**场景**: 从联系人列表选择收件人发送邮件
**测试步骤**:
1. 添加联系人
2. 撰写邮件时使用联系人
3. 验证邮件发送成功
4. 验证收件人信息正确

### 4.4 线程视图与搜索集成
**场景**: 在线程视图中搜索邮件
**测试步骤**:
1. 切换到线程视图
2. 执行搜索
3. 验证搜索结果以线程形式显示
4. 验证线程完整性

---

## 5. 性能测试

### 5.1 大数据量测试

#### 测试场景1: 1000+标签
- 创建1000个标签
- 测试标签列表加载时间
- 测试标签搜索性能
- **预期**: 列表加载 < 1秒，搜索 < 0.5秒

#### 测试场景2: 100+过滤规则
- 创建100条过滤规则
- 测试规则执行时间
- 测试规则列表加载时间
- **预期**: 执行100条规则 < 5秒

#### 测试场景3: 10000+邮件
- 同步10000封邮件
- 测试列表加载性能
- 测试搜索性能
- 测试过滤性能
- **预期**: 分页加载 < 1秒，搜索 < 2秒

#### 测试场景4: 1000+联系人
- 添加1000个联系人
- 测试联系人列表加载
- 测试联系人搜索
- **预期**: 列表加载 < 1秒，搜索 < 0.5秒

### 5.2 并发操作测试
- 同时执行多个同步操作
- 同时执行多个过滤规则
- 同时操作多个账户
- **预期**: 无死锁，无数据损坏

### 5.3 资源占用测试
- 监控内存使用
- 监控CPU使用
- 监控磁盘I/O
- **预期**: 内存 < 500MB，CPU < 50%

---

## 6. 边界条件测试

### 6.1 空值测试
- 创建空名称的标签
- 创建无条件的过滤规则
- 添加空邮箱的联系人
- **预期**: 适当的错误提示

### 6.2 极限值测试
- 超长标签名称（1000字符）
- 超多条件的过滤规则（100个条件）
- 超大附件（100MB）
- **预期**: 适当的限制和提示

### 6.3 特殊字符测试
- 标签名包含特殊字符（@#$%）
- 文件夹名包含特殊字符
- 联系人名包含Unicode字符
- **预期**: 正确处理，无乱码

### 6.4 异常输入测试
- 无效的邮件ID
- 不存在的标签名
- 无效的账户配置
- **预期**: 友好的错误提示

---

## 7. 回归测试

### 7.1 P0功能验证
- 验证邮件接收功能正常
- 验证邮件发送功能正常
- 验证回复转发功能正常
- 验证草稿功能正常
- 验证删除功能正常
- 验证垃圾邮件过滤正常
- 验证签名功能正常

### 7.2 数据库完整性
- 验证数据库Schema正确
- 验证外键约束正常
- 验证索引存在且有效
- 验证数据迁移成功

### 7.3 命令兼容性
- 验证现有CLI命令仍然工作
- 验证命令参数向后兼容
- 验证配置文件兼容

---

## 8. 测试交付物

### 8.1 测试文档
- [x] P1功能测试计划.md（本文档）
- [ ] P1功能测试报告.md（测试完成后）
- [ ] Bug列表.md（更新）

### 8.2 测试数据
- [ ] 测试用例执行记录
- [ ] 性能测试数据
- [ ] Bug截图和日志

### 8.3 测试脚本
- [ ] 自动化测试脚本（如适用）
- [ ] 性能测试脚本
- [ ] 数据准备脚本

---

## 9. 测试进度计划

### 9.1 测试阶段

#### 阶段1: 功能测试（预计4-6小时）
- 标签和标记系统测试
- 过滤规则引擎测试
- 文件夹管理测试
- 联系人管理测试

#### 阶段2: 功能测试（预计4-6小时）
- 多账户支持测试
- 邮件线程视图测试
- 搜索和过滤增强测试
- 同步增强功能测试

#### 阶段3: 集成测试（预计2-3小时）
- 模块间集成测试
- 端到端场景测试

#### 阶段4: 性能和边界测试（预计2-3小时）
- 性能测试
- 边界条件测试
- 压力测试

#### 阶段5: 回归测试（预计1-2小时）
- P0功能回归测试
- 兼容性测试

#### 阶段6: Bug修复验证（预计2-4小时）
- Bug修复验证
- 重新测试

#### 阶段7: 文档编写（预计2-3小时）
- 测试报告编写
- Bug列表更新

### 9.2 里程碑
- [ ] 测试计划完成（2026-02-08）
- [ ] 功能测试完成
- [ ] 集成测试完成
- [ ] 性能测试完成
- [ ] 回归测试完成
- [ ] 测试报告完成

---

## 10. 风险与依赖

### 10.1 测试风险
- **风险1**: 开发任务延期导致测试时间压缩
  - **缓解措施**: 提前准备测试用例，开发完成后立即开始测试

- **风险2**: 测试环境不稳定
  - **缓解措施**: 提前准备和验证测试环境

- **风险3**: 发现严重Bug导致测试中断
  - **缓解措施**: 及时沟通，协调开发团队快速修复

### 10.2 依赖项
- 依赖任务#3-#10全部完成
- 依赖测试环境准备就绪
- 依赖测试数据准备完成

---

## 11. 测试通过标准

### 11.1 功能完整性
- 所有P1功能按设计文档实现
- 所有测试用例通过率 >= 95%
- 无阻塞性Bug（Blocker）
- 严重Bug（Critical）<= 2个

### 11.2 性能标准
- 列表加载时间 < 1秒
- 搜索响应时间 < 2秒
- 同步速度 >= 10封/秒
- 内存占用 < 500MB

### 11.3 质量标准
- 代码质量良好
- 错误处理完善
- 用户体验友好
- 文档完整准确

---

## 12. 测试团队

### 12.1 角色分工
- **QA负责人**: QA Team
- **功能测试**: QA Team
- **性能测试**: QA Team
- **文档编写**: QA Team

### 12.2 沟通机制
- 每日进度更新
- Bug及时报告
- 阻塞问题立即上报

---

## 附录A: 测试用例清单

### 标签和标记系统（20个测试用例）
- TC-TAG-001 ~ TC-TAG-020

### 过滤规则引擎（25个测试用例）
- TC-FILTER-001 ~ TC-FILTER-025

### 文件夹管理增强（20个测试用例）
- TC-FOLDER-001 ~ TC-FOLDER-020

### 联系人管理系统（20个测试用例）
- TC-CONTACT-001 ~ TC-CONTACT-020

### 多账户支持（20个测试用例）
- TC-ACCOUNT-001 ~ TC-ACCOUNT-020

### 邮件线程视图（15个测试用例）
- TC-THREAD-001 ~ TC-THREAD-015

### 搜索和过滤增强（20个测试用例）
- TC-SEARCH-001 ~ TC-SEARCH-020

### 同步增强功能（15个测试用例）
- TC-SYNC-001 ~ TC-SYNC-015

**总计**: 约155个测试用例

---

## 附录B: 参考文档
- docs/P1功能技术设计.md
- docs/P0功能测试报告.md
- docs/功能清单.md
- docs/architecture.md

---

**文档版本**: v1.0
**最后更新**: 2026-02-08
**维护人**: QA Team

---

**测试计划结束**
