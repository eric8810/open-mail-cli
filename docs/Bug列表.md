# Bug åˆ—è¡¨

## æ–‡æ¡£ä¿¡æ¯
- **é¡¹ç›®**: é‚®ç®±å®¢æˆ·ç«¯ P0 åŠŸèƒ½
- **ç‰ˆæœ¬**: v1.0.0
- **æµ‹è¯•æ—¥æœŸ**: 2026-02-08
- **æµ‹è¯•äººå‘˜**: QA Team

---

## Bug ç»Ÿè®¡

| ä¸¥é‡ç¨‹åº¦ | æ•°é‡ | çŠ¶æ€ |
|---------|------|------|
| ğŸ”´ é˜»å¡æ€§ (Blocker) | 0 | - |
| ğŸŸ  ä¸¥é‡ (Critical) | 0 | - |
| ğŸŸ¡ ä¸€èˆ¬ (Major) | 0 | - |
| ğŸŸ¢ è½»å¾® (Minor) | 0 | - |
| **æ€»è®¡** | **2** | **å·²ä¿®å¤** |

---

## å·²ä¿®å¤é—®é¢˜

### Bug #1: ç¼ºå°‘ä¾èµ–åŒ… cli-table3

#### åŸºæœ¬ä¿¡æ¯
- **Bug ID**: BUG-001
- **ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é˜»å¡æ€§ (Blocker)
- **ä¼˜å…ˆçº§**: P0 (æœ€é«˜)
- **çŠ¶æ€**: âœ… å·²ä¿®å¤
- **å‘ç°æ—¥æœŸ**: 2026-02-08
- **ä¿®å¤æ—¥æœŸ**: 2026-02-08
- **å‘ç°äºº**: QA Team
- **ä¿®å¤äºº**: Development Team
- **å½±å“ç‰ˆæœ¬**: v1.0.0
- **ä¿®å¤ç‰ˆæœ¬**: v1.0.1

#### é—®é¢˜æè¿°
åœ¨è¿è¡Œ `draft list` å’Œ `trash list` å‘½ä»¤æ—¶ï¼Œç¨‹åºæŠ›å‡ºæ¨¡å—æœªæ‰¾åˆ°é”™è¯¯ï¼Œå¯¼è‡´è¿™ä¸¤ä¸ªå‘½ä»¤å®Œå…¨æ— æ³•ä½¿ç”¨ã€‚

#### é”™è¯¯ä¿¡æ¯
```
Error: Cannot find module 'cli-table3'
Require stack:
- D:\code\mail\src\cli\commands\draft.js
- D:\code\mail\src\cli\index.js
- D:\code\mail\src\index.js
```

#### å¤ç°æ­¥éª¤
1. å®‰è£…é‚®ç®±å®¢æˆ·ç«¯
2. è¿è¡Œå‘½ä»¤: `mail-client draft list`
3. æˆ–è¿è¡Œå‘½ä»¤: `mail-client trash list`
4. è§‚å¯Ÿåˆ°é”™è¯¯

#### å½±å“èŒƒå›´
- âŒ `mail-client draft list` - æ— æ³•è¿è¡Œ
- âŒ `mail-client trash list` - æ— æ³•è¿è¡Œ
- âœ… å…¶ä»–å‘½ä»¤ - ä¸å—å½±å“

#### å—å½±å“æ–‡ä»¶
- `src/cli/commands/draft.js:4`
- `src/cli/commands/trash.js:4`
- `package.json` (ç¼ºå°‘ä¾èµ–å£°æ˜)

#### æ ¹æœ¬åŸå› 
åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨äº† `cli-table3` åŒ…æ¥æ ¼å¼åŒ–è¡¨æ ¼è¾“å‡ºï¼Œä½†å¿˜è®°åœ¨ `package.json` ä¸­å£°æ˜è¯¥ä¾èµ–ã€‚

#### ä¿®å¤æ–¹æ¡ˆ

åœ¨ `package.json` ä¸­æ·»åŠ äº†ç¼ºå¤±çš„ä¾èµ–ï¼š
```json
{
  "dependencies": {
    "cli-table3": "^0.6.3"
  }
}
```

#### ä¿®å¤éªŒè¯
- âœ… `mail-client draft list` - æ­£å¸¸è¿è¡Œ
- âœ… `mail-client trash list` - æ­£å¸¸è¿è¡Œ
- âœ… è¡¨æ ¼æ˜¾ç¤ºæ­£å¸¸

---

### Bug #2: delete.jså¼•ç”¨ä¸å­˜åœ¨çš„accountæ¨¡å—

#### åŸºæœ¬ä¿¡æ¯
- **Bug ID**: BUG-002
- **ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é˜»å¡æ€§ (Blocker)
- **ä¼˜å…ˆçº§**: P0 (æœ€é«˜)
- **çŠ¶æ€**: âœ… å·²ä¿®å¤
- **å‘ç°æ—¥æœŸ**: 2026-02-08
- **ä¿®å¤æ—¥æœŸ**: 2026-02-08
- **å‘ç°äºº**: User
- **ä¿®å¤äºº**: Development Team
- **å½±å“ç‰ˆæœ¬**: v1.0.0
- **ä¿®å¤ç‰ˆæœ¬**: v1.0.1

#### é—®é¢˜æè¿°
åœ¨è¿è¡Œé‚®ä»¶åˆ é™¤å‘½ä»¤æ—¶ï¼Œç¨‹åºæŠ›å‡ºæ¨¡å—æœªæ‰¾åˆ°é”™è¯¯ã€‚`delete.js` æ–‡ä»¶ä¸­å¼•ç”¨äº†ä¸å­˜åœ¨çš„ `account` æ¨¡å—ã€‚

#### é”™è¯¯ä¿¡æ¯
```
Error: Cannot find module '../../storage/models/account'
Require stack:
- D:\code\mail\src\cli\commands\delete.js
```

#### å¤ç°æ­¥éª¤
1. è¿è¡Œä»»ä½•åˆ é™¤å‘½ä»¤
2. è§‚å¯Ÿåˆ°æ¨¡å—æœªæ‰¾åˆ°é”™è¯¯

#### å½±å“èŒƒå›´
- âŒ `mail-client delete <id>` - æ— æ³•è¿è¡Œ
- âŒ `mail-client delete <id> --permanent` - æ— æ³•è¿è¡Œ
- âœ… å…¶ä»–å‘½ä»¤ - ä¸å—å½±å“

#### å—å½±å“æ–‡ä»¶
- `src/cli/commands/delete.js:3` - é”™è¯¯çš„requireè¯­å¥
- `src/cli/commands/delete.js:36, 60` - ä½¿ç”¨accountModelçš„åœ°æ–¹

#### æ ¹æœ¬åŸå› 
ä»£ç ä¸­å°è¯•ä½¿ç”¨ `accountModel.findByEmail()` æ¥è·å–IMAPé…ç½®ï¼Œä½†ï¼š
1. `src/storage/models/account.js` æ–‡ä»¶ä¸å­˜åœ¨
2. åº”è¯¥ä½¿ç”¨ `config.load()` æ¥è·å–IMAPé…ç½®ï¼ˆä¸å…¶ä»–å‘½ä»¤ä¿æŒä¸€è‡´ï¼‰

#### ä¿®å¤æ–¹æ¡ˆ

**ä¿®æ”¹å‰**:
```javascript
const accountModel = require('../../storage/models/account');
// ...
const account = accountModel.findByEmail(email.from);
if (account) {
  const imapClient = new IMAPClient({
    user: account.email,
    password: account.imap_password,
    host: account.imap_host,
    port: account.imap_port,
    secure: account.imap_secure === 1
  });
}
```

**ä¿®æ”¹å**:
```javascript
const config = require('../../config');
// ...
const cfg = config.load();
if (cfg.imap.host && cfg.imap.user && cfg.imap.password) {
  const imapClient = new IMAPClient({
    user: cfg.imap.user,
    password: cfg.imap.password,
    host: cfg.imap.host,
    port: cfg.imap.port,
    secure: cfg.imap.secure
  });
}
```

#### ä¿®å¤éªŒè¯
- âœ… `mail-client delete <id>` - æ­£å¸¸è¿è¡Œ
- âœ… `mail-client delete <id> --permanent` - æ­£å¸¸è¿è¡Œ
- âœ… IMAPè¿æ¥æ­£å¸¸
- âœ… é‚®ä»¶åˆ é™¤åŠŸèƒ½æ­£å¸¸

---

## é˜»å¡æ€§é—®é¢˜ (Blocker)

æš‚æ— 

---

## ä¸€èˆ¬é—®é¢˜ (Major)

æš‚æ— 

---

## è½»å¾®é—®é¢˜ (Minor)

æš‚æ— 

---

## æ½œåœ¨æ”¹è¿›å»ºè®®

è™½ç„¶ä¸æ˜¯ Bugï¼Œä½†ä»¥ä¸‹æ˜¯ä¸€äº›æ½œåœ¨çš„æ”¹è¿›å»ºè®®ï¼š

### å»ºè®® #1: æ·»åŠ ä¾èµ–æ£€æŸ¥è„šæœ¬
**æè¿°**: æ·»åŠ ä¸€ä¸ªè„šæœ¬æ¥æ£€æŸ¥æ‰€æœ‰ä»£ç ä¸­ä½¿ç”¨çš„ä¾èµ–æ˜¯å¦éƒ½åœ¨ package.json ä¸­å£°æ˜ã€‚

**å®ç°æ–¹æ¡ˆ**:
```javascript
// scripts/check-dependencies.js
const fs = require('fs');
const path = require('path');

// æ‰«ææ‰€æœ‰ require() è¯­å¥
// æ£€æŸ¥æ˜¯å¦åœ¨ package.json ä¸­å£°æ˜
```

### å»ºè®® #2: æ·»åŠ å•å…ƒæµ‹è¯•
**æè¿°**: ä¸ºæ‰€æœ‰æ–°å¢åŠŸèƒ½æ·»åŠ å•å…ƒæµ‹è¯•ï¼Œé¿å…ç±»ä¼¼é—®é¢˜ã€‚

**å®ç°æ–¹æ¡ˆ**:
- ä½¿ç”¨ Jest æ¡†æ¶
- è¦†ç›–æ‰€æœ‰ CLI å‘½ä»¤
- è¦†ç›–æ‰€æœ‰æ ¸å¿ƒæ¨¡å—

### å»ºè®® #3: æ·»åŠ  CI/CD æµç¨‹
**æè¿°**: æ·»åŠ æŒç»­é›†æˆæµç¨‹ï¼Œè‡ªåŠ¨è¿è¡Œæµ‹è¯•å’Œä¾èµ–æ£€æŸ¥ã€‚

**å®ç°æ–¹æ¡ˆ**:
- ä½¿ç”¨ GitHub Actions
- è‡ªåŠ¨è¿è¡Œæµ‹è¯•
- è‡ªåŠ¨æ£€æŸ¥ä¾èµ–

### å»ºè®® #4: æ”¹è¿›é”™è¯¯æç¤º
**æè¿°**: å½“ç¼ºå°‘ä¾èµ–æ—¶ï¼Œæä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤ºå’Œä¿®å¤å»ºè®®ã€‚

**å®ç°æ–¹æ¡ˆ**:
```javascript
try {
  const Table = require('cli-table3');
} catch (error) {
  console.error('Missing dependency: cli-table3');
  console.error('Please run: npm install cli-table3');
  process.exit(1);
}
```

---

## Bug ä¿®å¤ä¼˜å…ˆçº§

### ç«‹å³ä¿®å¤ (P0)
1. âœ… Bug #1: ç¼ºå°‘ä¾èµ–åŒ… cli-table3

### çŸ­æœŸä¿®å¤ (P1)
æš‚æ— 

### é•¿æœŸä¿®å¤ (P2)
æš‚æ— 

---

## æµ‹è¯•å»ºè®®

### å›å½’æµ‹è¯•æ¸…å•
ä¿®å¤ Bug #1 åï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å›å½’æµ‹è¯•ï¼š

#### è‰ç¨¿åŠŸèƒ½æµ‹è¯•
- [ ] `mail-client draft save` - ä¿å­˜è‰ç¨¿
- [ ] `mail-client draft list` - åˆ—å‡ºè‰ç¨¿ (é‡ç‚¹æµ‹è¯•)
- [ ] `mail-client draft edit --id 1` - ç¼–è¾‘è‰ç¨¿
- [ ] `mail-client draft send --id 1` - å‘é€è‰ç¨¿
- [ ] `mail-client draft delete --id 1` - åˆ é™¤è‰ç¨¿

#### åƒåœ¾ç®±åŠŸèƒ½æµ‹è¯•
- [ ] `mail-client delete 1` - åˆ é™¤é‚®ä»¶
- [ ] `mail-client trash list` - åˆ—å‡ºåƒåœ¾ç®± (é‡ç‚¹æµ‹è¯•)
- [ ] `mail-client trash restore 1` - æ¢å¤é‚®ä»¶
- [ ] `mail-client trash empty` - æ¸…ç©ºåƒåœ¾ç®±

#### è¡¨æ ¼æ˜¾ç¤ºæµ‹è¯•
- [ ] éªŒè¯è¡¨æ ¼æ ¼å¼æ­£ç¡®
- [ ] éªŒè¯è¡¨æ ¼å†…å®¹å®Œæ•´
- [ ] éªŒè¯è¡¨æ ¼å¯¹é½æ­£ç¡®
- [ ] éªŒè¯ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºæ­£å¸¸

---

## è´¨é‡ä¿è¯æªæ–½

ä¸ºé¿å…ç±»ä¼¼é—®é¢˜å†æ¬¡å‘ç”Ÿï¼Œå»ºè®®é‡‡å–ä»¥ä¸‹æªæ–½ï¼š

### 1. ä»£ç å®¡æŸ¥
- æ‰€æœ‰ä»£ç æäº¤å‰è¿›è¡Œ Code Review
- æ£€æŸ¥æ–°å¢ä¾èµ–æ˜¯å¦å·²å£°æ˜
- æ£€æŸ¥å¯¼å…¥è¯­å¥æ˜¯å¦æ­£ç¡®

### 2. è‡ªåŠ¨åŒ–æµ‹è¯•
- æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–
- æ·»åŠ é›†æˆæµ‹è¯•
- æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•

### 3. ä¾èµ–ç®¡ç†
- ä½¿ç”¨ `npm-check` æ£€æŸ¥ä¾èµ–
- å®šæœŸæ›´æ–°ä¾èµ–ç‰ˆæœ¬
- é”å®šä¾èµ–ç‰ˆæœ¬ (package-lock.json)

### 4. æŒç»­é›†æˆ
- é…ç½® CI/CD æµç¨‹
- è‡ªåŠ¨è¿è¡Œæµ‹è¯•
- è‡ªåŠ¨æ£€æŸ¥ä»£ç è´¨é‡

### 5. æ–‡æ¡£å®Œå–„
- æ›´æ–°å¼€å‘æ–‡æ¡£
- æ·»åŠ ä¾èµ–è¯´æ˜
- æ·»åŠ æ•…éšœæ’æŸ¥æŒ‡å—

---

## é™„å½•

### A. ä¾èµ–æ£€æŸ¥å‘½ä»¤
```bash
# æ£€æŸ¥æœªä½¿ç”¨çš„ä¾èµ–
npm prune

# æ£€æŸ¥è¿‡æœŸçš„ä¾èµ–
npm outdated

# æ£€æŸ¥å®‰å…¨æ¼æ´
npm audit

# æ£€æŸ¥ä¾èµ–æ ‘
npm list
```

### B. æµ‹è¯•å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•è¦†ç›–ç‡
npm run test:coverage

# è¿è¡Œç‰¹å®šæµ‹è¯•
npm test -- draft.test.js
```

### C. ç›¸å…³æ–‡æ¡£
- [P0åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š](./P0åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š.md)
- [ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ](./ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ.md)
- [æŠ€æœ¯è®¾è®¡æ–‡æ¡£](./P0åŠŸèƒ½æŠ€æœ¯è®¾è®¡.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-08
**ç»´æŠ¤äºº**: QA Team

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ä¼šéšç€ Bug çš„ä¿®å¤å’Œæ–°é—®é¢˜çš„å‘ç°æŒç»­æ›´æ–°ã€‚
