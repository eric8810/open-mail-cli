# 邮箱客户端用户使用手册

## 目录
1. [简介](#1-简介)
2. [安装与配置](#2-安装与配置)
3. [基础功能](#3-基础功能)
4. [回复与转发](#4-回复与转发)
5. [草稿管理](#5-草稿管理)
6. [邮件删除与垃圾箱](#6-邮件删除与垃圾箱)
7. [垃圾邮件过滤](#7-垃圾邮件过滤)
8. [邮件签名](#8-邮件签名)
9. [常见问题](#9-常见问题)
10. [故障排查](#10-故障排查)

---

## 1. 简介

### 1.1 关于本软件
这是一个功能强大的命令行邮箱客户端，支持 IMAP/SMTP 协议，提供完整的邮件管理功能。

### 1.2 主要特性
- ✅ 邮件收发 (IMAP/SMTP)
- ✅ 回复与转发
- ✅ 草稿管理
- ✅ 邮件删除与垃圾箱
- ✅ 智能垃圾邮件过滤
- ✅ 邮件签名管理
- ✅ 邮件搜索
- ✅ 附件支持

### 1.3 系统要求
- **Node.js**: >= 18.0.0
- **操作系统**: Windows, macOS, Linux
- **网络**: 需要互联网连接

---

## 2. 安装与配置

### 2.1 安装

#### 方法1: 使用 npm
```bash
npm install -g mail-client
```

#### 方法2: 从源码安装
```bash
git clone <repository-url>
cd mail-client
pnpm install
npm link
```

### 2.2 首次配置

运行配置命令：
```bash
mail-client config
```

按照提示输入以下信息：
- **IMAP 服务器地址** (例如: imap.gmail.com)
- **IMAP 端口** (通常是 993)
- **SMTP 服务器地址** (例如: smtp.gmail.com)
- **SMTP 端口** (通常是 465 或 587)
- **邮箱地址**
- **密码** (建议使用应用专用密码)

### 2.3 查看当前配置

```bash
mail-client config --show
```

### 2.4 修改配置

```bash
mail-client config --set smtp.host=smtp.example.com
```

---

## 3. 基础功能

### 3.1 同步邮件

从服务器同步邮件到本地：
```bash
# 同步收件箱
mail-client sync

# 同步指定文件夹
mail-client sync --folder Sent

# 同步指定日期之后的邮件
mail-client sync --since 2026-01-01
```

### 3.2 列出邮件

```bash
# 列出收件箱邮件
mail-client list

# 列出指定文件夹的邮件
mail-client list --folder Sent

# 只显示未读邮件
mail-client list --unread

# 分页显示
mail-client list --limit 20 --page 2
```

### 3.3 阅读邮件

```bash
# 阅读指定ID的邮件
mail-client read 123

# 显示原始邮件内容
mail-client read 123 --raw
```

### 3.4 发送邮件

#### 交互式发送
```bash
mail-client send
```

#### 非交互式发送
```bash
mail-client send \
  --to user@example.com \
  --subject "Hello" \
  --body "This is a test email"
```

#### 发送给多个收件人
```bash
mail-client send \
  --to user1@example.com,user2@example.com \
  --cc user3@example.com \
  --subject "Meeting" \
  --body "Meeting at 3pm"
```

### 3.5 搜索邮件

```bash
# 搜索关键词
mail-client search "meeting"

# 按发件人搜索
mail-client search --from boss@example.com

# 按主题搜索
mail-client search --subject "invoice"

# 按日期搜索
mail-client search --date 2026-02-01

# 在指定文件夹搜索
mail-client search "report" --folder Sent
```

---

## 4. 回复与转发

### 4.1 回复邮件

#### 回复发件人
```bash
# 交互式回复
mail-client reply 123

# 非交互式回复
mail-client reply 123 --body "Thanks for your email"
```

#### 回复全部
```bash
# 回复所有收件人
mail-client reply 123 --all

# 非交互式回复全部
mail-client reply 123 --all --body "Thanks everyone"
```

#### 使用编辑器回复
```bash
mail-client reply 123 --editor
```

### 4.2 转发邮件

#### 基本转发
```bash
# 交互式转发
mail-client forward 123

# 指定收件人转发
mail-client forward 123 --to user@example.com
```

#### 转发给多人
```bash
mail-client forward 123 --to user1@example.com,user2@example.com
```

#### 添加转发备注
```bash
mail-client forward 123 \
  --to user@example.com \
  --body "FYI - please review"
```

#### 不包含附件转发
```bash
mail-client forward 123 \
  --to user@example.com \
  --no-attachments
```

### 4.3 回复与转发的特性

✅ **回复功能**:
- 自动添加 "Re:" 前缀
- 引用原邮件内容 (带 `>` 标记)
- 设置正确的邮件头 (In-Reply-To, References)
- 保持邮件线程关系

✅ **转发功能**:
- 自动添加 "Fwd:" 前缀
- 包含原邮件完整内容
- 包含原邮件的附件 (可选)
- 添加转发标记头

---

## 5. 草稿管理

### 5.1 保存草稿

#### 交互式保存
```bash
mail-client draft save
```

#### 非交互式保存
```bash
mail-client draft save \
  --to user@example.com \
  --subject "Draft email" \
  --body "This is a draft"
```

### 5.2 列出草稿

```bash
# 列出所有草稿
mail-client draft list

# 限制显示数量
mail-client draft list --limit 10
```

### 5.3 编辑草稿

```bash
# 编辑指定ID的草稿
mail-client draft edit --id 5
```

### 5.4 发送草稿

```bash
# 发送指定ID的草稿
mail-client draft send --id 5
```

### 5.5 删除草稿

```bash
# 删除指定ID的草稿
mail-client draft delete --id 5
```

### 5.6 同步草稿

```bash
# 从服务器同步草稿
mail-client draft sync
```

### 5.7 草稿管理最佳实践

1. **定期清理**: 定期删除不需要的草稿
2. **及时发送**: 草稿保存后尽快发送或删除
3. **同步草稿**: 使用 `draft sync` 保持本地和服务器同步

---

## 6. 邮件删除与垃圾箱

### 6.1 删除邮件

#### 软删除 (移到垃圾箱)
```bash
# 删除邮件 (移到垃圾箱)
mail-client delete 123

# 跳过确认提示
mail-client delete 123 --yes
```

#### 永久删除
```bash
# 永久删除邮件 (不可恢复)
mail-client delete 123 --permanent

# 跳过确认提示
mail-client delete 123 --permanent --yes
```

### 6.2 查看垃圾箱

```bash
# 列出垃圾箱中的邮件
mail-client trash list

# 分页显示
mail-client trash list --limit 20 --offset 0
```

### 6.3 恢复邮件

```bash
# 从垃圾箱恢复邮件
mail-client trash restore 123
```

### 6.4 清空垃圾箱

```bash
# 清空垃圾箱 (永久删除所有邮件)
mail-client trash empty

# 跳过确认提示
mail-client trash empty --yes
```

### 6.5 删除功能说明

#### 软删除 vs 永久删除

| 操作 | 命令 | 可恢复 | 说明 |
|------|------|--------|------|
| 软删除 | `delete <id>` | ✅ 是 | 移到垃圾箱，可恢复 |
| 永久删除 | `delete <id> --permanent` | ❌ 否 | 彻底删除，不可恢复 |
| 清空垃圾箱 | `trash empty` | ❌ 否 | 删除垃圾箱所有邮件 |

⚠️ **警告**: 永久删除的邮件无法恢复，请谨慎操作！

---

## 7. 垃圾邮件过滤

### 7.1 标记垃圾邮件

```bash
# 标记为垃圾邮件
mail-client spam mark 123
```

### 7.2 取消垃圾邮件标记

```bash
# 取消垃圾邮件标记
mail-client spam unmark 123
```

### 7.3 查看垃圾邮件

```bash
# 列出所有垃圾邮件
mail-client spam list
```

### 7.4 黑名单管理

#### 添加到黑名单
```bash
# 添加邮箱地址到黑名单
mail-client spam blacklist add spam@example.com

# 添加整个域名到黑名单
mail-client spam blacklist add @spam-domain.com
```

#### 查看黑名单
```bash
mail-client spam blacklist list
```

#### 从黑名单移除
```bash
mail-client spam blacklist remove spam@example.com
```

### 7.5 白名单管理

#### 添加到白名单
```bash
# 添加邮箱地址到白名单
mail-client spam whitelist add friend@example.com

# 添加整个域名到白名单
mail-client spam whitelist add @trusted-domain.com
```

#### 查看白名单
```bash
mail-client spam whitelist list
```

#### 从白名单移除
```bash
mail-client spam whitelist remove friend@example.com
```

### 7.6 手动运行垃圾邮件过滤

```bash
# 对所有邮件运行垃圾邮件检测
mail-client spam filter
```

### 7.7 查看垃圾邮件统计

```bash
# 查看垃圾邮件统计信息
mail-client spam stats
```

### 7.8 垃圾邮件检测机制

#### 检测规则优先级
1. **白名单检查** (最高优先级) - 直接通过
2. **黑名单检查** - 立即标记为垃圾邮件
3. **关键词检测** - 检测主题和正文中的垃圾关键词
4. **可疑链接检测** - 检测邮件中的可疑链接
5. **邮件头分析** - 分析邮件头信息

#### 默认垃圾关键词
- `viagra`, `cialis`, `lottery`, `winner`, `prize`
- `click here`, `act now`, `limited time`

#### 评分机制
- 每个规则匹配会增加垃圾邮件评分
- 评分 >= 50 时标记为垃圾邮件
- 白名单中的邮件评分为 0
- 黑名单中的邮件评分为 100

### 7.9 垃圾邮件过滤最佳实践

1. **维护白名单**: 将重要联系人添加到白名单
2. **及时标记**: 发现垃圾邮件立即标记
3. **定期清理**: 定期清理垃圾邮件文件夹
4. **谨慎使用黑名单**: 避免误加重要邮箱

---

## 8. 邮件签名

### 8.1 创建签名

#### 交互式创建
```bash
mail-client signature create
```

#### 非交互式创建
```bash
# 创建纯文本签名
mail-client signature create \
  --name "Work" \
  --text "Best regards,\nJohn Doe\nSoftware Engineer"

# 创建HTML签名
mail-client signature create \
  --name "Work" \
  --html "<p>Best regards,<br><b>John Doe</b><br>Software Engineer</p>"

# 创建并设为默认
mail-client signature create \
  --name "Work" \
  --text "Best regards,\nJohn Doe" \
  --default
```

### 8.2 列出签名

```bash
# 列出所有签名
mail-client signature list
```

### 8.3 编辑签名

```bash
# 编辑指定ID的签名
mail-client signature edit --id 1 \
  --text "Updated signature"
```

### 8.4 删除签名

```bash
# 删除指定ID的签名
mail-client signature delete --id 1
```

### 8.5 设置默认签名

```bash
# 设置指定ID的签名为默认
mail-client signature set-default --id 1
```

### 8.6 签名自动插入

签名会自动插入到以下场景：
- ✅ 发送新邮件时
- ✅ 回复邮件时
- ✅ 转发邮件时
- ✅ 发送草稿时

### 8.7 签名格式

#### 纯文本签名示例
```
Best regards,
John Doe
Software Engineer
Company Name
john.doe@example.com
```

#### HTML签名示例
```html
<p>
  <b>Best regards,</b><br>
  John Doe<br>
  <i>Software Engineer</i><br>
  <a href="mailto:john.doe@example.com">john.doe@example.com</a>
</p>
```

### 8.8 签名管理最佳实践

1. **简洁明了**: 签名不要太长，3-5行为宜
2. **包含关键信息**: 姓名、职位、联系方式
3. **多个签名**: 为不同场景创建不同签名
4. **设置默认**: 为最常用的签名设置为默认

---

## 9. 常见问题

### 9.1 配置相关

#### Q: 如何配置 Gmail 账户？
A: Gmail 需要使用应用专用密码：
1. 访问 Google 账户设置
2. 启用两步验证
3. 生成应用专用密码
4. 使用应用专用密码配置邮箱客户端

配置示例：
```
IMAP: imap.gmail.com:993
SMTP: smtp.gmail.com:465
```

#### Q: 如何配置 Outlook 账户？
A: Outlook 配置示例：
```
IMAP: outlook.office365.com:993
SMTP: smtp.office365.com:587
```

#### Q: 如何配置 QQ 邮箱？
A: QQ 邮箱需要开启 IMAP/SMTP 服务并获取授权码：
```
IMAP: imap.qq.com:993
SMTP: smtp.qq.com:465 或 587
密码: 使用授权码，不是QQ密码
```

### 9.2 使用相关

#### Q: 如何查看邮件的附件？
A: 使用 `read` 命令查看邮件详情，附件信息会显示在邮件内容下方。

#### Q: 如何下载附件？
A: 附件会自动保存到本地存储目录，路径显示在邮件详情中。

#### Q: 如何批量删除邮件？
A: 目前不支持批量删除，需要逐个删除。建议使用搜索功能筛选后再删除。

#### Q: 草稿会自动同步到服务器吗？
A: 使用 `draft save --sync` 可以同步到服务器，或使用 `draft sync` 手动同步。

#### Q: 垃圾邮件过滤是自动的吗？
A: 在邮件同步时会自动检测，也可以使用 `spam filter` 手动运行过滤。

### 9.3 故障相关

#### Q: 提示 "SMTP configuration incomplete" 怎么办？
A: 运行 `mail-client config` 重新配置 SMTP 设置。

#### Q: 提示 "Email with ID xxx not found" 怎么办？
A: 邮件ID不存在，使用 `list` 命令查看可用的邮件ID。

#### Q: 提示 "Cannot find module 'cli-table3'" 怎么办？
A: 安装缺失的依赖：
```bash
npm install cli-table3
# 或
pnpm add cli-table3
```

#### Q: 邮件同步失败怎么办？
A: 检查以下几点：
1. 网络连接是否正常
2. IMAP 配置是否正确
3. 账户密码是否正确
4. 是否启用了 IMAP 服务

---

## 10. 故障排查

### 10.1 连接问题

#### 症状: 无法连接到 IMAP/SMTP 服务器
**可能原因**:
1. 网络连接问题
2. 服务器地址或端口错误
3. 防火墙阻止连接
4. 账户未启用 IMAP/SMTP 服务

**解决方案**:
1. 检查网络连接
2. 验证服务器地址和端口
3. 检查防火墙设置
4. 在邮箱设置中启用 IMAP/SMTP

### 10.2 认证问题

#### 症状: 认证失败
**可能原因**:
1. 用户名或密码错误
2. 需要使用应用专用密码
3. 账户被锁定

**解决方案**:
1. 重新配置账户信息
2. 使用应用专用密码 (Gmail, Outlook)
3. 检查账户状态

### 10.3 同步问题

#### 症状: 邮件同步失败或不完整
**可能原因**:
1. 网络不稳定
2. 服务器响应超时
3. 本地存储空间不足

**解决方案**:
1. 重新运行同步命令
2. 使用 `--since` 参数限制同步范围
3. 清理本地存储空间

### 10.4 性能问题

#### 症状: 命令执行缓慢
**可能原因**:
1. 邮件数量过多
2. 数据库未优化
3. 网络延迟

**解决方案**:
1. 使用分页查询 (`--limit`, `--page`)
2. 定期清理已删除邮件
3. 使用本地搜索而非服务器搜索

### 10.5 数据问题

#### 症状: 数据丢失或损坏
**可能原因**:
1. 数据库文件损坏
2. 意外删除
3. 同步冲突

**解决方案**:
1. 重新同步邮件
2. 从服务器恢复数据
3. 定期备份本地数据库

### 10.6 日志查看

查看日志文件以获取详细错误信息：
```bash
# 日志文件位置 (根据配置可能不同)
~/.mail-client/logs/
```

### 10.7 获取帮助

如果问题仍未解决：
1. 查看详细日志
2. 访问项目 GitHub Issues
3. 联系技术支持

---

## 11. 命令速查表

### 11.1 基础命令
```bash
mail-client config              # 配置账户
mail-client sync                # 同步邮件
mail-client list                # 列出邮件
mail-client read <id>           # 阅读邮件
mail-client send                # 发送邮件
mail-client search <keyword>    # 搜索邮件
```

### 11.2 回复与转发
```bash
mail-client reply <id>          # 回复邮件
mail-client reply <id> --all    # 回复全部
mail-client forward <id>        # 转发邮件
```

### 11.3 草稿管理
```bash
mail-client draft save          # 保存草稿
mail-client draft list          # 列出草稿
mail-client draft edit --id <id>    # 编辑草稿
mail-client draft send --id <id>    # 发送草稿
mail-client draft delete --id <id>  # 删除草稿
```

### 11.4 删除与垃圾箱
```bash
mail-client delete <id>         # 删除邮件
mail-client delete <id> --permanent  # 永久删除
mail-client trash list          # 查看垃圾箱
mail-client trash restore <id>  # 恢复邮件
mail-client trash empty         # 清空垃圾箱
```

### 11.5 垃圾邮件过滤
```bash
mail-client spam mark <id>      # 标记垃圾邮件
mail-client spam unmark <id>    # 取消标记
mail-client spam list           # 列出垃圾邮件
mail-client spam blacklist add <email>   # 添加黑名单
mail-client spam whitelist add <email>   # 添加白名单
mail-client spam filter         # 运行过滤
mail-client spam stats          # 查看统计
```

### 11.6 签名管理
```bash
mail-client signature create    # 创建签名
mail-client signature list      # 列出签名
mail-client signature edit --id <id>     # 编辑签名
mail-client signature delete --id <id>   # 删除签名
mail-client signature set-default --id <id>  # 设置默认
```

---

## 12. 附录

### 12.1 支持的邮件服务商

| 服务商 | IMAP | SMTP | 备注 |
|--------|------|------|------|
| Gmail | imap.gmail.com:993 | smtp.gmail.com:465 | 需要应用专用密码 |
| Outlook | outlook.office365.com:993 | smtp.office365.com:587 | - |
| QQ邮箱 | imap.qq.com:993 | smtp.qq.com:465 | 需要授权码 |
| 163邮箱 | imap.163.com:993 | smtp.163.com:465 | 需要授权码 |
| 126邮箱 | imap.126.com:993 | smtp.126.com:465 | 需要授权码 |

### 12.2 快捷键

命令行界面支持以下快捷键：
- `Ctrl+C`: 取消当前操作
- `Ctrl+D`: 退出程序
- `↑/↓`: 浏览历史命令

### 12.3 环境变量

可以通过环境变量配置：
```bash
export MAIL_CLIENT_CONFIG_PATH=~/.mail-client/config.json
export MAIL_CLIENT_DATA_PATH=~/.mail-client/data
```

### 12.4 数据存储位置

默认数据存储位置：
- **配置文件**: `~/.mail-client/config.json`
- **数据库**: `~/.mail-client/mail.db`
- **附件**: `~/.mail-client/attachments/`
- **日志**: `~/.mail-client/logs/`

---

**手册版本**: v1.0.0
**最后更新**: 2026-02-08
**作者**: QA Team

---

**使用愉快！**
